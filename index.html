<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart School - Full Subject Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --primary: #58a6ff;
            --success: #238636; --error: #da3633; --text: #c9d1d9;
            --opt-bg: #21262d;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 850px; margin: auto; }
        .card { background: var(--card); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #30363d; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        h2, h3 { color: var(--primary); text-align: center; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #8b949e; }

        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; margin-top: 5px; box-sizing: border-box; }
        button { background: var(--success); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        button:hover { opacity: 0.8; }

        /* Dashboard & Progress */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin: 20px 0; }
        .stat-box { background: #0d1117; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #30363d; }
        .stat-num { font-size: 1.4em; font-weight: bold; color: var(--primary); display: block; }
        
        /* Quiz */
        .option { background: var(--opt-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; border: 1px solid #30363d; transition: 0.2s; }
        .option:hover { border-color: var(--primary); }
        .correct { border-color: var(--success) !important; background: rgba(35, 134, 54, 0.1) !important; }
        .wrong { border-color: var(--error) !important; background: rgba(218, 54, 51, 0.1) !important; }
        .explanation { font-size: 0.9em; color: #8b949e; margin-top: 10px; display: none; padding-top: 10px; border-top: 1px solid #30363d; }
        
        .hidden { display: none; }
        .basket-group { padding: 10px; border: 1px dashed #444; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="setupScreen" class="card">
        <h2>Smart Student Planner</h2>
        <p style="text-align:center; font-size: 0.9em;">ඔබේ ශ්‍රේණිය සහ විෂයන් තෝරන්න</p>
        
        <label>ශ්‍රේණිය (Grade):</label>
        <select id="gradeSelect">
            <option value="10">Grade 10</option>
            <option value="11">Grade 11 (O/L)</option>
        </select>

        <label>අනිවාර්ය විෂයන් (Core Subjects):</label>
        <select id="coreSubject">
            <option value="sinhala">සිංහල</option>
            <option value="maths">ගණිතය</option>
            <option value="science">විද්‍යාව</option>
            <option value="english">ඉංග්‍රීසි</option>
            <option value="history">ඉතිහාසය</option>
            <option value="religion">ආගම</option>
        </select>

        <div class="basket-group">
            <label>කාණ්ඩ විෂය I (Basket I):</label>
            <select id="basket1">
                <option value="geo">භූගෝල විද්‍යාව</option>
                <option value="civic">පුරවැසි අධ්‍යාපනය</option>
                <option value="ict">ICT</option>
                <option value="entre">ව්‍යවසායකත්ව අධ්‍යයනය</option>
            </select>

            <label>කාණ්ඩ විෂය II (Basket II):</label>
            <select id="basket2">
                <option value="music">සංගීතය</option>
                <option value="dance">නර්තනය</option>
                <option value="art">චිත්‍ර කලාව</option>
                <option value="drama">නාට්‍ය හා රංග කලාව</option>
            </select>

            <label>කාණ්ඩ විෂය III (Basket III):</label>
            <select id="basket3">
                <option value="agri">කෘෂිකර්මය</option>
                <option value="health">සෞඛ්‍ය හා ශාරීරික අධ්‍යාපනය</option>
                <option value="tech">තාක්ෂණික විෂයන්</option>
            </select>
        </div>

        <label>විභාගයට ඇති දින ගණන:</label>
        <input type="number" id="daysInput" value="60">

        <button onclick="saveSetup()">වැඩපිළිවෙල ආරම්භ කරන්න</button>
    </div>

    <div id="dashboard" class="card hidden">
        <h2 id="userTitle">මගේ ප්‍රගතිය</h2>
        <div class="stats-grid">
            <div class="stat-box">ඉතිරි දින<span id="dLeft" class="stat-num">0</span></div>
            <div class="stat-box">මුළු ලකුණු<span id="tScore" class="stat-num">0</span></div>
            <div class="stat-box">Grade<span id="gShow" class="stat-num">-</span></div>
        </div>
        <div style="height: 250px;"><canvas id="progChart"></canvas></div>
        <button onclick="startSession()" style="background:var(--primary); margin-top:20px;">අද දින වැඩ ආරම්භ කරන්න</button>
        <button onclick="localStorage.clear(); location.reload();" style="background:none; border:1px solid var(--error); color:var(--error); margin-top:10px; padding:5px; font-size:12px;">Reset All</button>
    </div>

    <div id="quizArea" class="card hidden">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; color:var(--primary); font-weight:bold;">
            <span id="qIdxDisp">ප්‍රශ්නය 1</span>
            <span id="subTag">SCIENCE</span>
        </div>
        <h3 id="qTxt" style="text-align:left; line-height:1.4;">ප්‍රශ්නය මෙතැන දිස්වේ...</h3>
        <div id="optCont"></div>
        <button id="nextBtn" class="hidden" onclick="nextQ()">මීළඟ ප්‍රශ්නය</button>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('olTrackerData')) || null;
    let currentScore = 0, currentIdx = 0, chart;

    const questions = {
        "science": [
            {q: "ශාකයක ප්‍රභාසංස්ලේෂණය වැඩිපුරම සිදුවන්නේ කුමන අවයවයේද?", o: ["මූලය", "පුෂ්පය", "පත්‍රය", "කඳ"], c: 2, ex: ["මූලය ජලය අවශෝෂණය කරයි.", "පුෂ්පය ප්‍රජනක අවයවයයි.", "පත්‍රවල හරිතප්‍රද වැඩි බැවින් ප්‍රභාසංස්ලේෂණය පත්‍රයේ සිදුවේ.", "කඳ ශාකය දරා සිටියි."]}
        ],
        "ict": [
            {q: "පහත ඒවායින් ප්‍රධාන මතක උපාංගයක් (Primary Memory) වන්නේ කුමක්ද?", o: ["Hard Disk", "RAM", "Pen Drive", "CD"], c: 1, ex: ["Hard Disk ද්විතීයික මතකයකි.", "RAM යනු ප්‍රධාන මතකයයි. එය තාවකාලික මතකයකි.", "Pen Drive බාහිර මතකයකි.", "CD ද්විතීයික මතකයකි."]}
        ]
    };

    function saveSetup() {
        db = {
            grade: document.getElementById('gradeSelect').value,
            core: document.getElementById('coreSubject').value,
            b1: document.getElementById('basket1').value,
            b2: document.getElementById('basket2').value,
            b3: document.getElementById('basket3').value,
            days: document.getElementById('daysInput').value,
            history: [], total: 0
        };
        localStorage.setItem('olTrackerData', JSON.stringify(db));
        showDash();
    }

    function showDash() {
        document.getElementById('setupScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('quizArea').classList.add('hidden');
        document.getElementById('dLeft').innerText = db.days - db.history.length;
        document.getElementById('tScore').innerText = db.total;
        document.getElementById('gShow').innerText = db.grade;
        initChart();
    }

    function initChart() {
        const ctx = document.getElementById('progChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: db.history.map(h => "Day " + h.d),
                datasets: [{ label: 'ලකුණු මට්ටම', data: db.history.map(h => h.s), borderColor: '#58a6ff', backgroundColor: 'rgba(88, 166, 255, 0.1)', fill: true, tension: 0.3 }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function startSession() {
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('quizArea').classList.remove('hidden');
        // අහඹු ලෙස විෂයක් තෝරාගැනීම (Core හෝ Basket එකකින්)
        const subs = [db.core, db.b1, db.b2, db.b3];
        const randomSub = subs[Math.floor(Math.random() * subs.length)];
        document.getElementById('subTag').innerText = randomSub.toUpperCase();
        
        currentScore = 0; currentIdx = 0;
        loadQ(randomSub);
    }

    function loadQ(sub) {
        const qList = questions[sub] || questions["science"];
        const q = qList[currentIdx];
        document.getElementById('qTxt').innerText = q.q;
        const cont = document.getElementById('optCont');
        cont.innerHTML = "";
        document.getElementById('nextBtn').classList.add('hidden');

        q.o.forEach((opt, i) => {
            const d = document.createElement('div');
            d.className = 'option';
            d.innerHTML = `<b>${i+1}.</b> ${opt} <div class="explanation">${q.ex[i]}</div>`;
            d.onclick = () => {
                document.querySelectorAll('.option').forEach(el => el.style.pointerEvents = 'none');
                if(i === q.c) { d.classList.add('correct'); currentScore += 10; }
                else { d.classList.add('wrong'); document.querySelectorAll('.option')[q.c].classList.add('correct'); }
                document.querySelectorAll('.explanation').forEach(e => e.style.display = 'block');
                document.getElementById('nextBtn').classList.remove('hidden');
            };
            cont.appendChild(d);
        });
    }

    function nextQ() {
        // දැනට එක් ප්‍රශ්නයක් පමණක් පෙන්වයි. දත්ත වැඩි කරද්දී මෙය වෙනස් කළ හැක.
        db.history.push({d: db.history.length + 1, s: currentScore});
        db.total += currentScore;
        localStorage.setItem('olTrackerData', JSON.stringify(db));
        showDash();
    }

    if(db) showDash();
</script>
</body>
</html>
