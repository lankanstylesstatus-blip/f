<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Pro - Learning & Progress Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0a0a0a; --card: #161616; --primary: #3498db;
            --success: #2ecc71; --error: #e74c3c; --text: #ffffff;
            --opt-bg: #222;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 800px; margin: auto; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        
        /* Stats Dashboard */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .stat-box { background: #1e1e1e; padding: 15px; border-radius: 12px; text-align: center; border-bottom: 4px solid var(--primary); }
        .stat-num { font-size: 1.6em; font-weight: bold; display: block; color: var(--primary); }
        .chart-container { position: relative; height: 250px; width: 100%; margin: 20px 0; }

        /* UI Elements */
        select, input { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #333; background: #222; color: white; margin-bottom: 15px; font-size: 16px; }
        button { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; font-size: 16px; }
        
        /* MCQ Styling */
        .option { background: var(--opt-bg); padding: 18px; border-radius: 12px; margin-bottom: 12px; cursor: pointer; border: 2px solid transparent; transition: 0.3s; }
        .correct-final { border-color: var(--success) !important; background: rgba(46, 204, 113, 0.1) !important; }
        .wrong-final { border-color: var(--error) !important; background: rgba(231, 76, 60, 0.1) !important; }
        .explanation { font-size: 0.9em; color: #b0b0b0; margin-top: 10px; display: none; line-height: 1.5; border-top: 1px solid #444; pt-10; }
        .fb-tag { font-weight: bold; margin-bottom: 5px; display: block; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="setupScreen" class="card">
        <h2>සාදරයෙන් පිළිගනිමු!</h2>
        <p>ඔබේ ඉලක්කය සැකසීමට පහත තොරතුරු ඇතුළත් කරන්න:</p>
        <select id="userGrade">
            <option value="12">Grade 12 (12 ශ්‍රේණිය)</option>
            <option value="13">Grade 13 (13 ශ්‍රේණිය)</option>
            <option value="revision">Revision (පුනරීක්ෂණ)</option>
        </select>
        <input type="number" id="daysLeftInput" placeholder="විභාගයට තව දින කීයක් තිබේද? (උදා: 60)">
        <button onclick="saveSetup()">වැඩපිළිවෙල ආරම්භ කරන්න</button>
    </div>

    <div id="dashboard" class="card hidden">
        <h2 id="greetUser">මගේ ප්‍රගතිය (Progress Tracker)</h2>
        <div class="stats-grid">
            <div class="stat-box">ඉතිරි දින<span class="stat-num" id="daysDisp">0</span></div>
            <div class="stat-box">මුළු ලකුණු<span class="stat-num" id="scoreDisp">0</span></div>
        </div>
        <div class="chart-container">
            <canvas id="progressChart"></canvas>
        </div>
        <button onclick="startQuiz()">අද දින MCQ ආරම්භ කරන්න</button>
        <button onclick="resetData()" style="margin-top:10px; background:none; color:var(--error); border:1px solid var(--error); font-size:12px; padding:5px;">සියලු දත්ත මකන්න (Reset)</button>
    </div>

    <div id="quizArea" class="card hidden">
        <div id="qHeader" style="display:flex; justify-content:space-between; color:#aaa; margin-bottom:15px;">
            <span id="qCountDisp">ප්‍රශ්නය 1 / 2</span>
            <span id="gradeTag">Grade 12</span>
        </div>
        <div id="qContent">
            <h3 id="questionText" style="line-height:1.5;">ප්‍රශ්නය මෙතැන දිස්වේ...</h3>
            <div id="optionsContainer"></div>
        </div>
        <button id="nextBtn" class="hidden" style="background: var(--success); margin-top:20px;" onclick="processNext()">මීළඟ ප්‍රශ්නය / අවසන් කරන්න</button>
    </div>
</div>

<script>
    // Data Structure
    let appData = JSON.parse(localStorage.getItem('chemStudentData')) || null;
    let currentSessionScore = 0;
    let currentQuestionIdx = 0;
    let chartObj = null;

    // Questions Database (Sample)
    const questionsDB = {
        "12": [
            { q: "පරමාණුවක න්‍යෂ්ටිය සොයාගනු ලැබුවේ කවුද?", o: ["ජෝන් ඩෝල්ටන්", "ජේ.ජේ. තොම්සන්", "අර්නස්ට් රදර්ෆර්ඩ්", "නීල්ස් බෝර්"], c: 2, ex: ["ඩෝල්ටන් පරමාණුක වාදය ඉදිරිපත් කළේය.", "තොම්සන් ඉලෙක්ට්‍රෝනය සොයාගත්තේය.", "රදර්ෆර්ඩ් රන්පත් පරීක්ෂාව මගින් න්‍යෂ්ටිය සොයාගත්තේය.", "බෝර් විසින් ශක්ති මට්ටම් හඳුන්වා දුන්නේය."] },
            { q: "ms (භ්‍රමණ ක්වොන්ටම් අංකය) සඳහා විය හැකි අගයන් මොනවාද?", o: ["0, 1", "+1, -1", "+1/2, -1/2", "0 සිට n-1"], c: 2, ex: ["0 යනු භ්‍රමණ අගයක් නොවේ.", "භ්‍රමණය පූර්ණ සංඛ්‍යා නොවේ.", "භ්‍රමණය සැමවිටම +1/2 හෝ -1/2 වේ.", "මෙය l අගය සඳහා පරාසයයි."] }
        ],
        "13": [
            { q: "එන්තැල්පි වෙනස (ΔH) ධන අගයක් ගන්නා ප්‍රතික්‍රියා?", o: ["තාපදායක", "තාප අවශෝෂක", "ස්වයංසිද්ධ", "සමතාපී"], c: 1, ex: ["තාපදායක වල ΔH සෘණ වේ.", "තාපය ලබාගන්නා විට පද්ධතියේ ශක්තිය වැඩි වී ΔH ධන වේ.", "ස්වයංසිද්ධතාව තීරණය වන්නේ ගිබ්ස් ශක්තියෙනි.", "සමතාපී වල උෂ්ණත්වය වෙනස් නොවේ."] }
        ]
    };

    function saveSetup() {
        const grade = document.getElementById('userGrade').value;
        const days = document.getElementById('daysLeftInput').value;
        if(!days || days < 1) return alert("කරුණාකර වලංගු දින ගණනක් ඇතුළත් කරන්න.");

        appData = { grade: grade, totalDays: parseInt(days), history: [], totalPoints: 0 };
        localStorage.setItem('chemStudentData', JSON.stringify(appData));
        showDashboard();
    }

    function showDashboard() {
        document.getElementById('setupScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('quizArea').classList.add('hidden');
        
        document.getElementById('daysDisp').innerText = appData.totalDays - appData.history.length;
        document.getElementById('scoreDisp').innerText = appData.totalPoints;
        updateChart();
    }

    function updateChart() {
        const ctx = document.getElementById('progressChart').getContext('2d');
        const labels = appData.history.map(h => "Day " + h.day);
        const scores = appData.history.map(h => h.score);

        if(chartObj) chartObj.destroy();
        chartObj = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ලබාගත් ලකුණු',
                    data: scores,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    fill: true, tension: 0.4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function startQuiz() {
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('quizArea').classList.remove('hidden');
        document.getElementById('gradeTag').innerText = "Grade: " + appData.grade;
        currentSessionScore = 0;
        currentQuestionIdx = 0;
        loadQuestion();
    }

    function loadQuestion() {
        const gradeList = questionsDB[appData.grade] || questionsDB["12"];
        const q = gradeList[currentQuestionIdx];
        
        document.getElementById('qCountDisp').innerText = `ප්‍රශ්නය ${currentQuestionIdx + 1} / ${gradeList.length}`;
        document.getElementById('questionText').innerText = q.q;
        const container = document.getElementById('optionsContainer');
        container.innerHTML = "";
        document.getElementById('nextBtn').classList.add('hidden');

        q.o.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option';
            div.innerHTML = `<b>${String.fromCharCode(65 + i)}.</b> ${opt} <div class="explanation" id="ex-${i}"></div>`;
            div.onclick = () => checkAnswer(i, q);
            container.appendChild(div);
        });
    }

    function checkAnswer(selectedIdx, q) {
        document.querySelectorAll('.option').forEach(el => el.style.pointerEvents = 'none');
        
        q.o.forEach((_, i) => {
            const optDiv = document.querySelectorAll('.option')[i];
            const exDiv = document.querySelectorAll('.explanation')[i];
            exDiv.style.display = 'block';
            exDiv.innerText = q.ex[i];

            if(i === q.c) {
                optDiv.classList.add('correct-final');
                const tag = document.createElement('span');
                tag.className = 'fb-tag'; tag.style.color = 'var(--success)';
                tag.innerText = "✓ නිවැරදි පිළිතුර";
                exDiv.prepend(tag);
            } else if(i === selectedIdx) {
                optDiv.classList.add('wrong-final');
                const tag = document.createElement('span');
                tag.className = 'fb-tag'; tag.style.color = 'var(--error)';
                tag.innerText = "✕ වැරදියි";
                exDiv.prepend(tag);
            }
        });

        if(selectedIdx === q.c) currentSessionScore += 10;
        document.getElementById('nextBtn').classList.remove('hidden');
    }

    function processNext() {
        const gradeList = questionsDB[appData.grade] || questionsDB["12"];
        currentQuestionIdx++;
        
        if(currentQuestionIdx < gradeList.length) {
            loadQuestion();
        } else {
            // Save Daily Progress
            const newDay = appData.history.length + 1;
            appData.history.push({ day: newDay, score: currentSessionScore });
            appData.totalPoints += currentSessionScore;
            localStorage.setItem('chemStudentData', JSON.stringify(appData));
            alert(`අද දින වැඩ අවසන්! ලකුණු: ${currentSessionScore}`);
            showDashboard();
        }
    }

    function resetData() {
        if(confirm("ඔබේ සියලුම ලකුණු සහ ප්‍රගතිය මැකීමට අවශ්‍යද?")) {
            localStorage.removeItem('chemStudentData');
            location.reload();
        }
    }

    // Initialize
    if(appData) showDashboard();
</script>

</body>
</html>
