<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart School - Multi Subject Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --primary: #58a6ff;
            --success: #238636; --error: #da3633; --text: #c9d1d9;
            --opt-bg: #21262d;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 850px; margin: auto; }
        .card { background: var(--card); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #30363d; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-box { background: #0d1117; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #30363d; }
        .stat-num { font-size: 1.5em; font-weight: bold; color: var(--primary); display: block; }

        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; margin-bottom: 15px; }
        button { background: var(--success); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; }
        
        .option { background: var(--opt-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; border: 1px solid #30363d; }
        .correct { border-color: var(--success) !important; background: rgba(35, 134, 54, 0.1) !important; }
        .wrong { border-color: var(--error) !important; background: rgba(218, 54, 51, 0.1) !important; }
        .explanation { font-size: 0.9em; color: #8b949e; margin-top: 8px; display: none; padding-top: 8px; border-top: 1px solid #30363d; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="setupScreen" class="card">
        <h2>ඔබේ ඉගෙනුම් මධ්‍යස්ථානය</h2>
        <label>ශ්‍රේණිය තෝරන්න:</label>
        <select id="gradeSelect">
            <option value="6">Grade 6</option>
            <option value="7">Grade 7</option>
            <option value="11">Grade 11 (O/L)</option>
            <option value="13">Grade 13 (A/L)</option>
        </select>
        
        <label>විෂය තෝරන්න:</label>
        <select id="subjectSelect">
            <option value="science">විද්‍යාව (Science)</option>
            <option value="maths">ගණිතය (Maths)</option>
            <option value="history">ඉතිහාසය (History)</option>
            <option value="chem">රසායන විද්‍යාව (Chemistry)</option>
        </select>
        
        <label>විභාගයට ඇති දින ගණන:</label>
        <input type="number" id="daysInput" placeholder="උදා: 180">
        
        <button onclick="saveSetup()">ඇතුල් වන්න</button>
    </div>

    <div id="dashboard" class="card hidden">
        <h2 id="dashTitle">ප්‍රගති වාර්තාව</h2>
        <div class="stats-grid">
            <div class="stat-box">ඉතිරි දින<span id="dLeft" class="stat-num">0</span></div>
            <div class="stat-box">මුළු ලකුණු<span id="tScore" class="stat-num">0</span></div>
            <div class="stat-box">Grade<span id="gShow" class="stat-num">-</span></div>
        </div>
        <div style="height: 200px;"><canvas id="progChart"></canvas></div>
        <button onclick="startSession()" style="background:var(--primary); margin-top:20px;">අද දින ප්‍රශ්න පත්‍රය ආරම්භ කරන්න</button>
    </div>

    <div id="quizArea" class="card hidden">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8em; color:var(--primary);">
            <span id="qIdxDisp">ප්‍රශ්නය 1</span>
            <span id="subTag">Science</span>
        </div>
        <h3 id="qTxt">ප්‍රශ්නය මෙතැන දිස්වේ...</h3>
        <div id="optCont"></div>
        <button id="nextBtn" class="hidden" onclick="nextQ()" style="margin-top:15px;">මීළඟ ප්‍රශ්නය</button>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('schoolAppData')) || null;
    let currentScore = 0, currentIdx = 0, chart;

    // විෂය සහ ශ්‍රේණි අනුව ප්‍රශ්න (මෙතනට ඕනෑම ප්‍රමාණයක ප්‍රශ්න එකතු කළ හැක)
    const questions = {
        "11_science": [
            {q: "සෛලයේ ශක්ති ඒකකය කුමක්ද?", o: ["න්‍යෂ්ටිය", "මයිටොකොන්ඩ්‍රියාව", "රයිබොසෝම", "සෛල ප්ලාස්මය"], c: 1, ex: ["න්‍යෂ්ටිය පාලන මධ්‍යස්ථානයයි.", "මයිටොකොන්ඩ්‍රියාවේ ATP නිපදවන බැවින් එය ශක්ති ඒකකයයි.", "රයිබොසෝම ප්‍රෝටීන් නිපදවයි.", "ප්ලාස්මය ද්‍රව්‍යයකි."]}
        ],
        "13_chem": [
            {q: "H2O අණුවේ හැඩය කුමක්ද?", o: ["රේඛීය", "තලත්‍රිකෝණාකාර", "කෝණික / නැමුණු", "චතුස්තලීය"], c: 2, ex: ["රේඛීය හැඩය CO2 වල ඇත.", "BF3 තලත්‍රිකෝණාකාර වේ.", "ඔක්සිජන් මත ඇති හුදකලා ඉලෙක්ට්‍රෝන යුගල නිසා ජල අණුව කෝණික වේ.", "CH4 චතුස්තලීය වේ."]}
        ]
    };

    function saveSetup() {
        db = {
            grade: document.getElementById('gradeSelect').value,
            subject: document.getElementById('subjectSelect').value,
            days: document.getElementById('daysInput').value,
            history: [], total: 0
        };
        localStorage.setItem('schoolAppData', JSON.stringify(db));
        showDash();
    }

    function showDash() {
        document.getElementById('setupScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('quizArea').classList.add('hidden');
        document.getElementById('dLeft').innerText = db.days - db.history.length;
        document.getElementById('tScore').innerText = db.total;
        document.getElementById('gShow').innerText = db.grade;
        initChart();
    }

    function initChart() {
        const ctx = document.getElementById('progChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: db.history.map(h => "Day " + h.d),
                datasets: [{ label: 'Score', data: db.history.map(h => h.s), borderColor: '#58a6ff', tension: 0.3 }]
            },
            options: { maintainAspectRatio: false }
        });
    }

    function startSession() {
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('quizArea').classList.remove('hidden');
        document.getElementById('subTag').innerText = db.subject.toUpperCase();
        currentScore = 0; currentIdx = 0;
        loadQ();
    }

    function loadQ() {
        const key = `${db.grade}_${db.subject}`;
        const qList = questions[key] || questions["11_science"];
        const q = qList[currentIdx];
        
        document.getElementById('qTxt').innerText = q.q;
        const cont = document.getElementById('optCont');
        cont.innerHTML = "";
        document.getElementById('nextBtn').classList.add('hidden');

        q.o.forEach((opt, i) => {
            const d = document.createElement('div');
            d.className = 'option';
            d.innerHTML = `<b>${i+1}.</b> ${opt} <div class="explanation">${q.ex[i]}</div>`;
            d.onclick = () => {
                document.querySelectorAll('.option').forEach(el => el.style.pointerEvents = 'none');
                if(i === q.c) { d.classList.add('correct'); currentScore += 10; }
                else { d.classList.add('wrong'); document.querySelectorAll('.option')[q.c].classList.add('correct'); }
                document.querySelectorAll('.explanation').forEach(e => e.style.display = 'block');
                document.getElementById('nextBtn').classList.remove('hidden');
            };
            cont.appendChild(d);
        });
    }

    function nextQ() {
        const key = `${db.grade}_${db.subject}`;
        const qList = questions[key] || questions["11_science"];
        currentIdx++;
        if(currentIdx < qList.length) loadQ();
        else {
            db.history.push({d: db.history.length + 1, s: currentScore});
            db.total += currentScore;
            localStorage.setItem('schoolAppData', JSON.stringify(db));
            alert("අද දින වැඩ අවසන්!");
            showDash();
        }
    }

    if(db) showDash();
</script>
</body>
</html>
